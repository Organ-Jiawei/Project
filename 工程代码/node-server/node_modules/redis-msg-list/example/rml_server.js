/**
 * RML服务端
 */
var config = require('./config');
var rml = require('./../index').createServer(config.RML_KEY, config.REDIS_OPTIONS);

rml.on('close', function(err) {
	console.log('Rml close: %s', err);
});

rml.on('error', function(err) {
	console.log('Rml error: %s', err);
});

rml.on('connect', function() {
	console.log('Rml connected.');
});


var i = 0;

// 监听消息-无限模式
console.time('time:');
rml.on('message', function(msg) {
	i++;
	if (i >= 100) {
		console.log(i, msg);
		console.timeEnd('time:');
	}
});
rml.listen();

// 监听消息-单条模式
// rml.on('message', function(msg, callback) {
// 	i++;
// 	console.log(i, msg);
// 	setTimeout(function() {
// 		callback();
// 	}, 1000);
// });
// rml.listen(1);

// 监听消息-多条模式
// rml.on('message', function(msg, callback) {
// 	i++;
// 	console.log(i, msg);
// 	setTimeout(function() {
// 		callback();
// 	}, 1000);
// });

// rml.listen(10);