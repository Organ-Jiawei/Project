/**
 * rmlClient类 - 用于发送消息
 */
'use strict';

const Redis = require('redis');
const Events = require('events');

class rmlClient extends Events {
	// 构造函数
	constructor() {
		super();
	}

	// 建立连接
	connect(key, options) {
		var self = this;

		this._key = key; //消息队列键名
		this._redis = Redis.createClient(options);

		// redis数据库连接失败
		this._redis.on('error', function(err) {
			self.listeners('close').length && self.emit('close', err);
		});

		// redis数据库连接成功
		this._redis.on('connect', function() {
			self.listeners('connect').length && self.emit('connect');
		});
	}

	// 发送消息
	send() {
		var params = [this._key];
		for (var i of arguments) {
			params.push(JSON.stringify(i));
		}
		this._redis.rpush(params, function(err, results) {
			if (err) {
				self.listeners('error').length && self.emit('error', err);
			}
		});
	}
}



module.exports = rmlClient;